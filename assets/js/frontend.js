!function(t,o,s,a={}){const n=t.wpApiSettings.root,l=t.wpApiSettings.nonce;t.listo={ajax(t,e={},i="GET"){return o.ajax({url:""+n+t,method:i,data:e,dataType:"json",beforeSend(t){t.setRequestHeader("X-WP-Nonce",l)}}).fail(t=>{t&&t.responseJSON&&alert(t.responseJSON.message)})},template(t){var e={variable:"data",evaluate:/\{\{([\s\S]+?)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,escape:/\{\{-([\s\S]+?)\}\}/g};let i=s.template(t,e);return i="function"!=typeof i?s.template(t,null,e):i},data(e="",i){let o=a,s;e=e.split(".");for(let t=0;t<e.length&&void 0!==o[e[t]];t++)t===e.length-1?void 0===i?s=o[e[t]]:o[e[t]]=i:o=o[e[t]];return s},class(t,e){if(t.match(/^Listo([A-Z][a-z]+)*$/))return"function"==typeof e&&"function"==typeof(e=e(this,o))&&(this[t]=e),this[t];throw new Error("Invalid Listo class name.")},focus(t){var e;(t=t.jquery?t[0]:t).focus(),t.setSelectionRange&&(e=t.value.length,t.setSelectionRange(e,e))}}}(window,window.jQuery,window._,window.listoData),function(t){const i={capitalize(t=""){return t.replace(/(?:^|-)([a-z0-9])/gi,function(t,e){return e.toUpperCase()})},pad(t="",e=0,i=""){if(i.length)for(t+="";t.length<e;)t=i+t;return t},escapeHtml(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},nl2br(t){return t.replace(/\r?\n/g,"<br>")},h12to24(t,e){return t=12==+t?"pm"===e?12:0:"pm"===e?+t+12:t,i.pad(String(t),2,"0")},h24to12(t){return t=12<+t?+t-12:0<+t?t:12,i.pad(String(t),2,"0")},h24ampm(t){return 11<+t?"pm":"am"},parseDate(t){var e;return"string"==typeof t&&(e=t.match(/^(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})$/))?{date:`${e[1]}-${e[2]}-`+e[3],time:`${e[4]}:${e[5]}:`+e[6],hours:e[4],hours12h:+e[4]%12?i.pad(+e[4]%12,2,"0"):"12",minutes:e[5],seconds:e[6],ampm:+e[4]<12?"am":"pm"}:t}};Object.assign(t,{string:i})}(window.listo),function(t){Object.assign(t,{hooks:function(){let n={};function i(t,e,i,o=10){if("function"==typeof e&&(o=i||o,i=e,e=`cb_t${(new Date).getTime()}_r`+(1e4+Math.floor(1e4*Math.random()))),"function"!=typeof i)throw new Error("The callback parameter must be a function.");if("number"!=typeof o)throw new Error("The priority parameter must be a number.");let s=n[t],a=(s=s||(n[t]=[])).length;for(;0<a&&!(o>=s[a-1].priority);a--);return s.splice(a,0,{name:e,callback:i,priority:o}),e}function o(t,e){if(void 0===e)delete n[t];else{var i=n[t];if(i){for(let t=i.length-1;0<=t;t--)i[t].name===e&&i.splice(t,1);i.length||delete n[t]}}}function s(t,i,...o){let e=n[t],s;return i&&(s=o[0]),e&&(e=e.map(t=>t.callback)).forEach(t=>{try{var e=t.apply(null,o);i&&(s=o[0]=e)}catch(t){}}),s}return{addFilter(t,...e){return i("filter/"+t,...e)},removeFilter(t,...e){return o("filter/"+t,...e)},applyFilters(t,...e){return s("filter/"+t,!0,...e)},addAction(t,...e){return i("action/"+t,...e)},removeAction(t,...e){return o("action/"+t,...e)},doAction(t,...e){return s("action/"+t,!1,...e)}}}()})}(window.listo),function(t){const i=t["hooks"],o=t.string["parseDate"];i.addFilter("item_map",function(t){if(t instanceof Array)t=t.map(t=>i.applyFilters("item_map",t));else if("object"==typeof t)for(const e in t)-1<["due","created","edited","closed"].indexOf(e)&&(t[e+"_parsed"]=t[e]&&o(t[e]));return t})}(window.listo),function(t){function e(t){t.style.height="",t.style.height=+t.scrollHeight+"px"}t.fn.listo_autosize=function(){return this.each(function(){e(this),t(this).off("input.listo-autosize").on("input.listo-autosize",function(){e(this)})})}}(window.jQuery),listo.class("ListoAbstract",function(t,s){const i=t.string["capitalize"];return class{constructor(t){this.$container=s(t),this.$container.on("click change input","[data-listo]",t=>{this.triggerEventListener(t)})}triggerEventListener(t){var e=t.currentTarget.getAttribute("data-listo"),e="on"+i(e+"-"+t.type);"function"==typeof this[e]&&this[e](t)}progress(t,e,i){let o=s(t);"loading"===e?(o.prop("disabled",!0).css("opacity",.5),o.removeClass("success").addClass("loading"),o.data("force-loading",1),setTimeout(()=>{o.removeData("force-loading");var t=o.data("queue");t&&(o.removeData("queue"),this.progress(o,t.type,t.onComplete))},1e3)):o.data("force-loading")?o.data("queue",{type:e,onComplete:i}):"done"===e?(o.prop("disabled",!1).css("opacity",""),o.removeClass("loading").addClass("success"),setTimeout(()=>o.removeClass("success"),1e3),"function"==typeof i&&i()):"fail"===e&&(o.prop("disabled",!1).css("opacity",""),o.removeClass("loading success"),"function"==typeof i)&&i()}}}),listo.class("ListoRoot",function(o,a){const{ajax:i,hooks:n,template:s,data:l}=o,{escapeHtml:d,nl2br:r}=o.string,c=!!+l("enable_collections");l("animation_speed");return class extends o.class("ListoAbstract"){constructor(t){super(t),this.collectionsMap={},this.currentCollection=l("last_viewed_collection");var e=s(l("templates.root")),i={enable_collections:c,lang:l("lang")};this.$el=a(t).html(e(i)),this.$wrapper=this.$el.find("[data-listo=wrapper]"),this.$sidebar=this.$el.find("[data-listo=sidebar]"),this.$sidebarCollapse=this.$el.find("[data-listo=sidebar-collapse]"),this.$sidebarToggle=this.$el.find("[data-listo=sidebar-toggle]"),this.$smartCollections=this.$el.find("[data-listo=smart-collections]"),this.$collections=this.$el.find("[data-listo=collections]"),this.$collectionHeader=this.$el.find("[data-listo=collection-header]"),this.$items=this.$el.find("[data-listo=items]"),this.$panels=this.$el.find("[data-listo=panel]"),new(o.class("ListoCollectionHeader"))(this.$collectionHeader),new(o.class("ListoItems"))(this.$items),new(o.class("ListoNewCollection"))({toggle:this.$el.find("[data-listo=new-collection]"),form:this.$el.find("[data-listo=new-collection-form]")}),new(o.class("ListoNewItem"))({toggle:this.$el.find("[data-listo=new-item]"),form:this.$el.find("[data-listo=new-item-form]")}),this.sortable=new(o.class("ListoSortable"))(this.$el),new(o.class("ListoPreferences"))(this.$el.find("[data-listo=preferences]")),n.addFilter("current_collection_id",()=>this.currentCollection),n.addFilter("item_map",t=>this.itemMap(t)),n.addAction("switch_collection",t=>this.loadItems(t)),n.addAction("collection_added",t=>this.onCollectionAdded(t)),n.addAction("collection_updated",t=>this.onCollectionUpdated(t)),n.addAction("collection_deleted",t=>this.onCollectionDeleted(t)),n.addAction("items_loaded",()=>this.onItemsLoaded()),n.addAction("item_added",()=>this.onItemAdded()),n.addAction("item_moved",()=>this.onItemMoved()),n.addAction("preferences_updated",()=>this.onPreferencesUpdated()),n.addAction("gdpr_deleted",()=>this.onGdprDeleted()),n.addAction("count_items_updated",t=>this.onCountItemsUpdated(t)),n.addAction("maintenance",()=>this.maintenance()),a(document).on("keydown",t=>{"KeyF"===t.code&&t.ctrlKey&&!t.altKey&&this.onWrapperToggleClick(t)}),this.maintenance().always(()=>{c?this.loadCollections():this.loadItems("all")})}$collection(t){return this.$smartCollections.add(this.$collections).children(`[data-listo=collection][data-id=${t}]`)}$item(t){return this.$items.children(`[data-listo=item][data-id=${t}]`)}loadCollections(){return this.$panels.addClass("loading"),i("listowp/v1/collections").done(t=>{if(this.collectionsMap={},this.$smartCollections.empty(),this.$collections.empty(),t instanceof Array){t.sort((t,e)=>+t.order-+e.order);let i=s(l("templates.collection"));t.forEach(t=>{this.collectionsMap[t.id]=t;var e=i(t);(0<t.smart?this.$smartCollections:this.$collections).append(e)}),this.loadItems(this.currentCollection)}n.doAction("collections_loaded")}).always(()=>{this.$panels.removeClass("loading")})}itemMap(t){var e;return+this.currentCollection||"inbox"===this.currentCollection||(e=this.collectionsMap[t.collection||"inbox"],t.collection_id=e.id,t.collection_title=e.title,t.collection_icon=e.icon,t.collection_initials=e.initials),t}loadItems(t){this.$panels.addClass("loading"),this.currentCollection=t;var e=this.$el.find("[data-listo=collection]"),i=this.$collection(t);e.filter(".active").not(i).removeClass("active"),i.addClass("active"),n.doAction("set_current_collection",this.collectionsMap[t])}loadItem(t){return i("listowp/v1/items",{id:t}).done(t=>{})}updateItem(t,e={}){return i("listowp/v1/items",Object.assign(e,{id:t}),"PATCH").done(t=>{})}setTimezone(t){return i("listowp/v1/preferences",{id:"timezone",value:t},"PATCH")}maintenance(){return i("listowp/v1/maintenance").done(t=>{if(t instanceof Array&&t[0]instanceof Object)for(const e in t[0]){let s=t[0][e];this.$collection(e).find("[data-field^=count_items]").each((t,e)=>{var e=a(e),i=e.data("field"),o=s[i+"_formatted"];e.html(o),"count_items_due"===i&&(+o?e.show():e.hide())}),n.doAction("count_items_updated",Object.assign(s,{id:e}))}})}toggleSidebar(t){let e="lo-sidebar--expanded";void 0===t||+t?(this.$sidebar.addClass(e),this.$sidebarToggle.find("span").html(this.$sidebarToggle.data("label-tasks")),a(document).one("click.listo-sidebar",()=>{this.$sidebar.removeClass(e),this.$sidebarToggle.find("span").html(this.$sidebarToggle.data("label-lists"))})):(a(document).off("click.listo-sidebar"),this.$sidebar.removeClass(e),this.$sidebarToggle.find("span").html(this.$sidebarToggle.data("label-lists")))}onWrapperToggleClick(t){t.preventDefault(),t.stopPropagation(),this.$wrapper.toggleClass("lo-wrapper--fullscreen")}onSidebarCollapseClick(t){t.preventDefault(),t.stopPropagation();t="lo-sidebar--collapsed";this.$sidebar.hasClass(t)?(this.$sidebar.removeClass(t),this.$sidebarCollapse.removeClass("lo-tip--alt")):(this.$sidebar.addClass(t),this.$sidebarCollapse.addClass("lo-tip--alt"))}onSidebarToggleClick(t){t.preventDefault(),t.stopPropagation(),this.toggleSidebar(!this.$sidebar.hasClass("lo-sidebar--expanded"))}onCollectionAdded(t={}){"object"==typeof t&&t.id&&(this.currentCollection=t.id,this.loadCollections())}onCollectionUpdated(e={}){if("object"==typeof e&&e.id){var i,o,s=this.$collection(e.id),a=this.collectionsMap[e.id];for(const n in e){let t=e[n];a[n]=t,"icon"===n?(o=[...i=s.find("[data-field=icon]").get(0).classList].filter(t=>t.match(/^fa-/)),i.remove(...o),t&&i.add(...t.split(" "))):(-1<["initials","title","description"].indexOf(n)&&(t=r(d(t))),s.find(`[data-field=${n}]`).html(t))}}}onCollectionDeleted(t){this.$collection(t).remove(),this.currentCollection="inbox",this.loadCollections(),n.doAction("maintenance")}onCollectionClick(t){t.preventDefault(),t.stopPropagation();t=a(t.currentTarget);this.loadItems(t.data("id")),this.toggleSidebar(!1)}onItemsLoaded(){this.sortable.init(this.currentCollection)}onItemAdded(){n.doAction("maintenance")}onItemMoved(){n.doAction("maintenance")}onPreferencesUpdated(){c?this.loadCollections():this.loadItems("all")}onGdprDeleted(){location.reload(!0)}onCountItemsUpdated(t){this.collectionsMap[t.id]&&Object.assign(this.collectionsMap[t.id],t)}onPreferencesToggleClick(t){n.doAction("preferences_toggle")}onDropdownToggleClick(t){let e=a(t.currentTarget).siblings("[data-listo=dropdown-menu]");e.is(":hidden")?(t.stopPropagation(),e.show(),a(document).one("click",()=>e.hide())):e.hide()}onDropdownMenuClick(t){t.stopPropagation()}onPreferencesClick(t){t.stopPropagation()}}}),listo.class("ListoCollectionHeader",function(i,o){const{ajax:s,hooks:a,data:t}=i,{escapeHtml:n,nl2br:l}=i.string,d=+t("animation_speed");return class extends i.class("ListoAbstract"){constructor(t){super(t),this.data=null,this.saving=!1,this.$el=o(t),this.$info=this.$el.find("[data-listo=collection-info]"),this.$infoTitle=this.$info.find("[data-listo=title]"),this.$infoDescription=this.$info.find("[data-listo=description]"),this.$infoDescriptionToggle=this.$info.find("[data-listo=description-toggle]"),this.$edit=this.$el.find("[data-listo=edit-collection]"),this.$editForm=this.$el.find("[data-listo=edit-collection-form]"),this.$editTitle=this.$editForm.find("[name=title]"),this.$editDescription=this.$editForm.find("[name=description]"),this.$editCancel=this.$editForm.find("[data-listo=cancel]"),this.$editSave=this.$editForm.find("[data-listo=save]"),this.$delete=this.$el.find("[data-listo=delete-collection]"),this.$deleteForm=this.$el.find("[data-listo=delete-collection-form]"),this.$deleteCancel=this.$el.find("[data-listo=delete-collection-cancel]"),this.$deleteConfirm=this.$el.find("[data-listo=delete-collection-confirm]"),this.$createItem=o('[data-listo="wrapper"]').find("[data-listo=new-item]"),this.$el.find("[data-listo=custom-icon]").each((t,e)=>{new(i.class("ListoCustomIcons"))(e)}),this.$infoDescriptionToggle.on("click",t=>this.onInfoDescriptionToggleClick(t)),this.$edit.on("click",t=>this.onEditClick(t)),this.$editTitle.on("input",t=>this.onEditTitleInput(t)),this.$editDescription.on("input",t=>this.onEditDescriptionInput(t)),this.$editCancel.on("click",t=>this.onEditCancelClick(t)),this.$editSave.on("click",t=>this.onEditSaveClick(t)),this.$delete.on("click",t=>this.onDeleteClick(t)),this.$deleteCancel.on("click",t=>this.onDeleteCancelClick(t)),this.$deleteConfirm.on("click",t=>this.onDeleteConfirmClick(t)),a.addAction("set_current_collection",t=>this.update(t)),a.addAction("count_items_updated",t=>this.updateCountItems(t)),a.addAction("collections_loaded","new_item_form",()=>{a.removeAction("collections_loaded","new_item_form"),this.$el.show()})}reset(){var t=this.data.title.trim(),e=this.data.description.trim(),i=+this.data.smart,t=(this.$info.show(),this.$info.attr("data-id",this.data.id),this.$infoTitle.html(l(n(t))),this.$infoDescription.html(l(n(e))),this.$edit[i?"hide":"show"](),this.$editForm.hide(),this.$editTitle.val(t),this.$editDescription.val(e),this.$editCancel.removeAttr("disabled"),this.$editSave.attr("disabled","disabled"),this.$delete.parent()[i?"fadeOut":"fadeIn"](d),this.$delete.show(),this.$deleteForm.hide(),this.$deleteCancel.hide(),this.$createItem.show(),this.$infoDescription[0]);t.scrollHeight>1.5*t.clientHeight?this.$infoDescriptionToggle.show():this.$infoDescriptionToggle.hide(),this.updateCountItems(this.data)}update(t){this.data=t,this.reset()}updateCountItems(t={}){t.id===this.data.id&&(this.$info.find("[data-field=count_items]").html(t.count_items),this.$info.find("[data-field=count_items_done]").html(t.count_items_done),this.$info.find("[data-field=count_items_due]").html(t.count_items_due))}onInfoDescriptionToggleClick(t){t.preventDefault(),t.stopPropagation();t="auto"===this.$infoDescription[0].style.height;this.$infoDescription.css({height:t?"":"auto",overflow:t?"":"visible"}),this.$infoDescriptionToggle[t?"removeClass":"addClass"]("lo-tip--alt")}onToggleCompletedClick(t){t.preventDefault(),t.stopPropagation(),"done"!==this.data.id&&a.doAction("toggle_completed")}onEditClick(t){t.preventDefault(),t.stopPropagation(),this.$info.hide(),this.$edit.hide(),this.$editForm.show(),this.$editTitle.data("value",this.$editTitle.val()),this.$editDescription.data("value",this.$editDescription.val()).listo_autosize(),this.$editSave.attr("disabled","disabled"),this.$createItem.fadeOut(d),i.focus(this.$editTitle)}onEditTitleInput(t){var e=this.$editTitle.val();e.trim()&&e!==this.$editTitle.data("value")||this.$editDescription.val()!==this.$editDescription.data("value")?this.$editSave.removeAttr("disabled"):this.$editSave.attr("disabled","disabled")}onEditDescriptionInput(t){var e=this.$editTitle.val();e.trim()&&e!==this.$editTitle.data("value")||this.$editDescription.val()!==this.$editDescription.data("value")?this.$editSave.removeAttr("disabled"):this.$editSave.attr("disabled","disabled")}onEditCancelClick(t){t.preventDefault(),t.stopPropagation(),this.reset()}onEditSaveClick(t){if(t.preventDefault(),t.stopPropagation(),!this.saving){this.saving=!0,this.$editCancel.add(this.$editSave).attr("disabled","disabled");let e=this.data.id;var t=this.$editTitle.val().trim(),o=this.$editDescription.val().trim();let i={id:e,title:t,description:o};s("listowp/v1/collections",i,"PATCH").done(t=>{Object.assign(this.data,i),s("listowp/v1/collections",{id:e}).done(t=>{t instanceof Array&&t[0]&&(this.data=t[0])}).always(()=>{this.saving=!1,this.reset(),a.doAction("collection_updated",this.data)})})}}onDeleteClick(t){t.preventDefault(),t.stopPropagation(),this.$delete.hide(),this.$deleteForm.add(this.$deleteCancel).fadeIn(d)}onDeleteCancelClick(t){t.preventDefault(),t.stopPropagation(),this.$deleteForm.add(this.$deleteCancel).fadeOut(d,()=>this.$delete.show())}onDeleteConfirmClick(t){t.preventDefault(),t.stopPropagation();let e=this.$deleteCancel.find("i"),i=o("<div/>").css({position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(255,255,255,0.5)"});i.appendTo(this.$el),e.attr("class","fa-solid fa-circle-notch fa-spin"),s("listowp/v1/collections/"+this.data.id,{},"DELETE").always(()=>{i.remove(),e.attr("class","fa-solid fa-xmark")}).done(t=>{this.$deleteForm.add(this.$deleteCancel).hide(),this.$delete.show(),a.doAction("collection_deleted",this.data.id)})}onCreateItemClick(t){}}}),listo.class("ListoNewCollection",function(o,e){const{ajax:s,hooks:a,data:t}=o,i=+t("animation_speed");return class{constructor(t={}){this.saving=!1,this.$toggle=e(t.toggle),this.$form=e(t.form),this.$title=this.$form.find("[name=title]"),this.$cancel=this.$form.find("[data-listo=cancel]"),this.$save=this.$form.find("[data-listo=save]"),this.$toggle.on("click",t=>t.stopPropagation()||this.show()),this.$form.on("click",t=>t.stopPropagation()),this.$title.on("keydown",t=>this.onKeyDown(t)),this.$title.on("input",()=>this.onInput()),this.$cancel.on("click",t=>t.stopPropagation()||this.hide()),this.$save.on("click",()=>this.submit()),a.addAction("new_item_form",()=>this.hide()),a.addAction("collections_loaded","new_collection_form",()=>{a.removeAction("collections_loaded","new_collection_form"),this.$toggle.show()})}show(){this.$form.is(":hidden")&&(this.$toggle.hide(),this.$form.fadeIn(i),o.focus(this.$title),a.doAction("new_collection_form"))}hide(){this.$form.is(":visible")&&(this.$form.hide(),this.$toggle.fadeIn(i))}value(t){if("string"!=typeof t)return this.$title.val().trim();this.$title.val(t.trim())}submit(){let i=this.value();i&&!this.saving&&(this.saving=!0,this.onInput(),s("listowp/v1/collections",{},"POST").done(e=>{if(e instanceof Array&&e[0]){let t=Object.assign(e[0],{title:i});e=t["id"];s("listowp/v1/collections",{id:e,title:i},"PATCH").always(()=>{this.value(""),this.saving=!1,this.onInput(),o.focus(this.$title),a.doAction("collection_added",t)})}}))}onKeyDown(t){"Enter"===t.code?(t.preventDefault(),t.stopPropagation(),this.$save.trigger("click")):"Escape"===t.code&&this.hide()}onInput(){this.value()&&!this.saving?this.$save.removeAttr("disabled"):this.$save.attr("disabled","disabled")}}}),listo.class("ListoItems",function(h,p){const{ajax:s,hooks:n,template:l,data:d}=h,a=+d("animation_speed");return class{constructor(t){this.collection=null,this.hideCompleted=null,this.$el=p(t),this.$el.on("click","[data-listo=item]",t=>this.onItemClick(t)),this.$el.on("click","[data-listo=item-toggle]",t=>this.onItemToggleClick(t)),this.$el.on("click","[data-listo=item-check]",t=>this.onItemCheckClick(t)),this.$el.on("click","[data-listo=item-collection]",t=>this.onItemCollectionClick(t)),this.$el.on("click","[data-listo=description-toggle]",t=>this.onDescriptionToggleClick(t)),this.$el.on("click","[data-listo=delete-item]",t=>this.onDeleteItemClick(t)),this.$el.on("click","[data-listo=delete-item-cancel]",t=>this.onCancelDeleteItemClick(t)),this.$el.on("click","[data-listo=delete-item-confirm]",t=>this.onConfirmDeleteItemClick(t)),this.$el.on("click","[data-listo=edit-item]",t=>this.onEditItemClick(t)),this.$el.on("input","[name=title]",t=>this.onEditTitleInput(t)),this.$el.on("input","[name=description]",t=>this.onEditDescriptionInput(t)),this.$el.on("click","[data-listo=cancel]",t=>this.onCancelEditItemClick(t)),this.$el.on("click","[data-listo=save]",t=>this.onSaveEditItemClick(t)),new(h.class("ListoItemDue"))(t),n.addAction("set_current_collection",t=>{this.collection=t.id,this.update()}),n.addAction("item_added",()=>this.update()),n.addAction("preferences_init",t=>this.onPreferencesUpdated(t)),n.addAction("preferences_updated",t=>this.onPreferencesUpdated(t))}update(){this.$el.empty();let t=setTimeout(()=>{var t=l(d("templates.item_list_loading"));this.$el.html(t())},250);s("listowp/v1/items",{collection:this.collection}).always(()=>clearTimeout(t)).done(t=>{this.render(t),n.doAction("items_loaded",t)})}render(t){if(this.$el.empty(),t instanceof Array&&t.length){let e=l(d("templates.item"));(t=n.applyFilters("item_map",t)).forEach(t=>this.$el.append(e(t)))}}loadItem(t){return s("listowp/v1/items",{id:t}).done(t=>{})}updateItem(t,e={}){return s("listowp/v1/items",Object.assign(e,{id:t}),"PATCH")}toggleItem(t,e){var i=p(t),o=p("[data-listo=item]"),s="lo-task--full";!0!==e||i.hasClass(s)?!1===e&&i.hasClass(s)?i.removeClass(s):void 0===e&&this.toggleItem(t,!i.hasClass(s)):(o.removeClass(s),i.addClass(s))}onPreferencesUpdated(t){this.hideCompleted=+t.items_hide_done}onItemClick(t){t.preventDefault(),t.stopPropagation(),this.toggleItem(t.currentTarget,!0)}onItemToggleClick(t){t.preventDefault(),t.stopPropagation();t=p(t.currentTarget).closest("[data-listo=item]");this.toggleItem(t)}onItemCheckClick(t){t.preventDefault(),t.stopPropagation();let s=p(t.currentTarget).closest("[data-listo=item]");if(!s.data("saving")){s.data("saving",1);let e=s.data("id"),i=s.data("rrule_id"),o=+s.data("status")?0:1;this.updateItem(e,{status:o,rrule_id:i}).done(t=>{i&&o?(this.update(),s.removeData("saving"),n.doAction("item_updated",t[0]),n.doAction("maintenance")):"done"===this.collection&&!o||this.hideCompleted&&o?(s.remove(),s.removeData("saving"),n.doAction("item_updated",t[0]),n.doAction("maintenance")):this.loadItem(e).done(t=>{var e;t instanceof Array&&t.length&&(e=l(d("templates.item")),t=n.applyFilters("item_map",t[0]),s.replaceWith(e(t)),n.doAction("item_updated",t)),s.removeData("saving"),n.doAction("maintenance")})})}}onItemCollectionClick(t){t.preventDefault(),t.stopPropagation(),n.doAction("switch_collection",p(t.currentTarget).data("collection"))}onDeleteItemClick(t){t.preventDefault(),t.stopPropagation();t=p(t.currentTarget).closest("[data-listo=item]");t.find("[data-listo=delete-item]").hide(),t.find("[data-listo=delete-item-form]").add(t.find("[data-listo=delete-item-cancel]")).fadeIn(a)}onCancelDeleteItemClick(t){t.preventDefault(),t.stopPropagation();let e=p(t.currentTarget).closest("[data-listo=item]");e.find("[data-listo=delete-item-form]").add(e.find("[data-listo=delete-item-cancel]")).fadeOut(a,()=>{e.find("[data-listo=delete-item]").show()})}onConfirmDeleteItemClick(t){t.preventDefault(),t.stopPropagation();let e=p(t.currentTarget).closest("[data-listo=item]");t=e.data("id");let i=e.find("[data-listo=delete-item-cancel] i"),o=p("<div/>").css({position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(255,255,255,0.5)"});return o.appendTo(e),i.attr("class","fa-solid fa-circle-notch fa-spin"),s("listowp/v1/items/"+t,{},"DELETE").always(()=>{o.remove(),i.attr("class","fa-solid fa-xmark")}).done(()=>{e.siblings().length?e.css({opacity:0}).slideUp(a,()=>e.remove()):this.render([]),n.doAction("maintenance")})}onDescriptionToggleClick(t){t.preventDefault(),t.stopPropagation();var t=p(t.currentTarget).closest("[data-listo=item]"),e=t.find("[data-listo=description]").parent(),t=t.find("[data-listo=description-toggle]");e.slideToggle(),t.toggleClass("lo-tip--alt")}onEditItemClick(t){t.preventDefault(),t.stopPropagation();var t=p(t.currentTarget).closest("[data-listo=item]"),e=t.find("[data-listo=item-check]").parent(),i=t.find("[data-listo=title]").parent(),o=t.find("[data-listo=description]").parent(),s=t.find("[data-listo=description-toggle]"),a=t.find("[data-listo=meta-actions]"),n=t.find("[data-listo=edit-item]"),l=t.find("[data-listo=edit-item-form]"),d=l.find("[name=title]"),r=l.find("[name=description]"),c=l.find("[data-listo=save]");t.toggleClass("lo-task--edit"),a.hide(),n.hide(),e.hide(),i.hide(),o.hide(),s.hide(),l.show(),d.data("value",d.val()),r.data("value",r.val()).listo_autosize(),c.attr("disabled","disabled"),h.focus(d)}onEditTitleInput(t){var t=p(t.currentTarget).closest("[data-listo=edit-item-form]"),e=t.find("[name=title]"),i=t.find("[name=description]"),t=t.find("[data-listo=save]");e.val().trim()&&e.val()!==e.data("value")||i.val()!==i.data("value")?t.removeAttr("disabled"):t.attr("disabled","disabled")}onEditDescriptionInput(t){var t=p(t.currentTarget).closest("[data-listo=edit-item-form]"),e=t.find("[name=title]"),i=t.find("[name=description]"),t=t.find("[data-listo=save]");e.val().trim()&&e.val()!==e.data("value")||i.val()!==i.data("value")?t.removeAttr("disabled"):t.attr("disabled","disabled")}onCancelEditItemClick(t){t.preventDefault(),t.stopPropagation();var t=p(t.currentTarget).closest("[data-listo=item]"),e=t.find("[data-listo=item-check]").parent(),i=t.find("[data-listo=title]").parent(),o=t.find("[data-listo=description]").parent(),s=t.find("[data-listo=description-toggle]"),a=t.find("[data-listo=meta-actions]"),n=t.find("[data-listo=edit-item]"),l=t.find("[data-listo=edit-item-form]"),d=l.find("[name=title]"),r=l.find("[name=description]"),c=l.find("[data-listo=save]");t.toggleClass("lo-task--edit"),e.show(),a.show(),n.show(),i.show(),o.hide(),s.show(),l.hide(),d.val(d.data("value")),r.val(r.data("value")),c.attr("disabled","disabled")}onSaveEditItemClick(t){t.preventDefault(),t.stopPropagation();let i=p(t.currentTarget).closest("[data-listo=item]");var t=i.find("[data-listo=edit-item-form]"),e=t.find("[name=title]"),o=t.find("[name=description]");let s=t.find("[data-listo=cancel]"),a=t.find("[data-listo=save]");t=i.data("id"),e=e.val().trim(),o=o.val().trim();if(!a.data("saving"))return a.data("saving",1),a.add(s).attr("disabled","disabled"),this.updateItem(t,{title:e,description:o}).always(()=>{a.removeData("saving"),a.add(s).removeAttr("disabled")}).done(t=>{var e=l(d("templates.item")),t=n.applyFilters("item_map",t[0]);i.replaceWith(e(t)),n.doAction("item_updated",t),n.doAction("maintenance")})}}}),listo.class("ListoItemDue",function(t,s){const{ajax:a,hooks:n,template:o,data:l}=t,{h12to24:d,h24to12:r,h24ampm:c,pad:h}=t.string;return class extends t.class("ListoAbstract"){constructor(t){super(t),s(document).on("click",()=>{this.$container.find("[data-listo=item]").each((t,e)=>{this.hide(e)})})}update(i,t){var e=this.$item(i).data("id");return t=Object.assign({},t,{id:e}),a("listowp/v1/items",t,"PATCH").done(t=>{var e;t instanceof Array&&t[0]&&(e=o(l("templates.item_due")),t=n.applyFilters("item_map",t[0]),this.$toggle(i).replaceWith(e(t))),n.doAction("maintenance")})}$item(t){return s(t.currentTarget||t).closest("[data-listo=item]")}$toggle(t){return this.$item(t).find("[data-listo=item-due]")}$popup(t){return this.$item(t).find("[data-listo=item-due-popup]")}show(t){var e,i,o,t=this.$popup(t),s=(this.$container.find("[data-listo=item-due-popup]").not(t).filter(":visible").hide(),t.show(),t.find("[data-listo=item-due-date]")),s=(s.val()||(e=(o=new Date).getFullYear(),i=h(o.getMonth()+1,2,"0"),o=h(o.getDate(),2,"0"),s.val(e+`-${i}-`+o).trigger("change")),n.doAction("item_due_show",t),n.applyFilters("item_due_can_submit",!0,t));this.toggleSubmit(t,s)}hide(t){this.$popup(t).hide()}toggle(t){this.$popup(t).is(":visible")?this.hide(t):this.show(t)}toggleSubmit(t,e){let i=t.find("[data-listo=item-due-set]");"boolean"==typeof e?e?i.removeAttr("disabled"):i.attr("disabled","disabled"):e&&e.done&&(i.attr("disabled","disabled"),e.done(t=>{t?i.removeAttr("disabled"):i.attr("disabled","disabled")}))}onItemClick(t){this.hide(t)}onItemDueClick(t){t.stopPropagation(),this.toggle(t)}onItemDuePopupClick(t){t.stopPropagation()}onItemDueDateClick(t){t.currentTarget.showPicker()}onItemDueDateChange(t){var e=s(t.currentTarget);let i=e.siblings("[type=text]"),o=e.siblings("[data-listo=loading]");e=e.val();e?(i.css("opacity",0),o.show(),a("listowp/v1/time",{date:e}).done(t=>{t.date_formatted&&(o.hide(),i.val(t.date_formatted).css("opacity",""))}),n.doAction("item_due_date_changed",this.$popup(t))):(i.val("").css("opacity",""),o.hide())}onItemDueHoursChange(t){var e=this.$item(t),i=e.find("[data-listo=item-due-hours-12h]"),e=e.find("[data-listo=item-due-ampm]"),t=+t.currentTarget.value;i.val(r(t)),e.val(c(t))}onItemDueHours12hChange(t){var e=this.$item(t),i=e.find("[data-listo=item-due-ampm]");e.find("[data-listo=item-due-hours]").val(d(+t.currentTarget.value,i.val()))}onItemDueMinutesChange(t){this.$item(t).find("[data-listo=item-due-minutes-12h]").val(t.currentTarget.value)}onItemDueMinutes12hChange(t){this.$item(t).find("[data-listo=item-due-minutes]").val(t.currentTarget.value)}onItemDueAmpmChange(t){var e=this.$item(t),i=e.find("[data-listo=item-due-hours-12h]");e.find("[data-listo=item-due-hours]").val(d(i.val(),t.currentTarget.value))}onItemDueSetClick(t){t.stopPropagation();var e=this.$popup(t),i=e.find("[data-listo=item-due-date]").val(),o=e.find("[data-listo=item-due-hours]").val(),s=e.find("[data-listo=item-due-minutes]").val(),i={due:i+(i?" "+(o+`:${s}:00`):"")},i=n.applyFilters("item_due_submit_data",i,e);this.update(t,i)}onItemDueClearClick(t){t.stopPropagation(),this.update(t,{due:""})}}}),listo.class("ListoNewItem",function(a,e){const{ajax:n,hooks:l,data:t}=a,i=+t("animation_speed");return class{constructor(t={}){this.saving=!1,this.$toggle=e(t.toggle),this.$form=e(t.form),this.$title=this.$form.find("[name=title]"),this.$cancel=this.$form.find("[data-listo=cancel]"),this.$save=this.$form.find("[data-listo=save]"),this.$toggle.on("click",t=>t.stopPropagation()||this.show()),this.$form.on("click",t=>t.stopPropagation()),this.$title.on("keydown",t=>this.onKeyDown(t)),this.$title.on("input",()=>this.onInput()),this.$cancel.on("click",t=>t.stopPropagation()||this.hide()),this.$save.on("click",()=>this.submit()),l.addAction("new_collection_form",()=>this.hide()),l.addAction("set_current_collection",()=>this.hide())}show(){this.$form.is(":hidden")&&(this.$toggle.hide(),this.$form.fadeIn(i),a.focus(this.$title),l.doAction("new_item_form"))}hide(){this.$form.is(":visible")&&(this.$form.hide(),this.$toggle.fadeIn(i))}value(t){if("string"!=typeof t)return this.$title.val().trim();this.$title.val(t.trim())}submit(){let s=this.value();s&&!this.saving&&(this.saving=!0,this.onInput(),n("listowp/v1/items",{},"POST").done(i=>{if(i instanceof Array&&i[0]){var o=l.applyFilters("current_collection_id");let t=Object.assign(i[0],{title:s,collection:o});i=t["id"];let e=!+o&&-1===["all","inbox"].indexOf(o);o=+o||void 0,n("listowp/v1/items",{id:i,title:s,collection:o},"PATCH").always(()=>{this.value(""),this.saving=!1,this.onInput(),a.focus(this.$title),e?l.doAction("switch_collection","all"):l.doAction("item_added",t)})}}))}onKeyDown(t){"Enter"===t.code?(t.preventDefault(),t.stopPropagation(),this.$save.trigger("click")):"Escape"===t.code&&this.hide()}onInput(){this.value()&&!this.saving?this.$save.removeAttr("disabled"):this.$save.attr("disabled","disabled")}}}),listo.class("ListoSortable",function(t,n){const{ajax:i,hooks:o,data:e}=t,l=+e("animation_speed")||0;return class{constructor(t){this.currentCollection=null,this.manualItemsOrder=null,this.container=t.jquery?t[0]:t,this.smartCollections=this.container.querySelector("[data-listo=smart-collections]"),this.collections=this.container.querySelector("[data-listo=collections]"),this.items=this.container.querySelector("[data-listo=items]"),this.container.addEventListener("dragstart",t=>this.onDragStart(t)),this.container.addEventListener("dragend",t=>this.onDragEnd(t)),this.container.addEventListener("dragenter",t=>this.onDragEnter(t)),this.container.addEventListener("dragover",t=>t.preventDefault()),this.container.addEventListener("dragleave",t=>this.onDragLeave(t)),this.container.addEventListener("drop",t=>this.onDrop(t)),"ontouchstart"in window&&(this.container.addEventListener("touchstart",t=>this.onTouchStart(t)),this.container.addEventListener("touchmove",t=>this.onTouchMove(t)),this.container.addEventListener("touchend",t=>this.onTouchEnd(t)),this.container.addEventListener("touchcancel",t=>this.onTouchCancel(t)),this.container.addEventListener("contextmenu",t=>t.preventDefault())),o.addAction("item_added",()=>this.onItemAdded()),o.addAction("item_updated",()=>this.onItemUpdated()),o.addAction("preferences_init",t=>this.onPreferencesUpdated(t)),o.addAction("preferences_updated",t=>this.onPreferencesUpdated(t))}init(t){this.currentCollection=String(t);var t=this.collections.querySelectorAll("[data-listo=collection]"),e=this.items.querySelectorAll("[data-listo=item]");Array.from(t).concat(Array.from(e)).forEach(t=>{t.getAttribute("draggable")||t.setAttribute("draggable","true")})}reorderCollections(){var t=this.collections.querySelectorAll("[data-listo=collection]"),t=Array.from(t).map(t=>t.getAttribute("data-id"));return i("listowp/v1/collections",{ids:t},"PATCH").done(()=>{o.doAction("collections_reorder")})}reorderItems(){var t=this.items.querySelectorAll("[data-listo=item]"),t=Array.from(t).map(t=>t.getAttribute("data-id")),e=this.currentCollection;return i("listowp/v1/items",{ids:t,collection:e},"PATCH").done(()=>{o.doAction("items_reorder")})}moveItem(t,e){return e=0<e?e:0,i("listowp/v1/items",{id:t,collection:e},"PATCH").done(()=>{o.doAction("item_moved",{id:t,collection:e})})}droppable(t,e){if(!t||t===e)return!1;var t=t.getAttribute("data-listo"),i=e.getAttribute("data-listo");if("collection"===t){if("collection"===i&&+e.getAttribute("data-smart"))return!1;if("item"===i)return!1}else if("item"===t)if("collection"===i){t=e.getAttribute("data-id");if(t===this.currentCollection)return!1;if(!t.match(/^(\d+|inbox)$/))return!1}else if("item"===i){if(!this.currentCollection.match(/^(\d+)$/))return!1;if(!this.manualItemsOrder)return!1}return!0}onDragStart(t){this.dragEl||(this.dragEl=a(t.target,"[draggable]"),this.dragImage=s(this.dragEl),t.dataTransfer.setDragImage(this.dragImage,t.offsetX,t.offsetY))}onDragEnd(t){this.dragEl&&(this.dragEl=null,this.dragImage.remove(),this.dragImage=null,this.dropTarget=null,this.container.querySelectorAll(".lo-droptarget").forEach(t=>{t.classList.remove("lo-droptarget")}))}onDragEnter(t){let e=t;t.target&&(e=a(t.target,"[data-listo=collection], [data-listo=item]")),this.dropTarget=null,e&&this.droppable(this.dragEl,e)&&(this.dropTarget=e).classList.add("lo-droptarget")}onDragLeave(t){let e=t;(e=t.target?a(t.target,"[data-listo=collection], [data-listo=item]"):e)&&e!==this.dropTarget&&e.classList.remove("lo-droptarget")}onDrop(t){t instanceof Event&&(t.preventDefault(),t.stopPropagation());let e=this.dragEl;var i,o,s,a,t=this.dropTarget;e&&t&&e!==t&&(i=e.getAttribute("data-listo"),o=t.getAttribute("data-listo"),s=e.getAttribute("data-id"),a=t.getAttribute("data-id"),"item"===i&&"collection"===o?(this.moveItem(s,a),n(e).css({opacity:0,transition:"none"}).slideUp(l,()=>e.remove())):i===o&&(s=e.parentElement,d(e)>d(t)?s.insertBefore(e,t):(a=t.nextElementSibling)?s.insertBefore(e,a):s.append(e),"collection"===i?this.reorderCollections():"item"===i&&this.reorderItems()))}onTouchStart(e){this.holdTimer=setTimeout(()=>{"function"==typeof DataTransfer?e.dataTransfer=new DataTransfer:e.dataTransfer={setDragImage(){}},this.onDragStart(e);var t=e.touches[0]||e.changedTouches[0];this.touchPageX=t.pageX,this.touchPageY=t.pageY},400)}onTouchMove(t){var e,i;clearTimeout(this.holdTimer),this.dragEl&&(t.preventDefault(),t.stopPropagation(),i=(t=t.touches[0]||t.changedTouches[0]).pageX-this.touchPageX,e=t.pageY-this.touchPageY,this.dragImage.style.transform=`translate(${i}px, ${e}px)`,this.dragImage.style.zIndex=100,this.dragImage.style.display="none",i=document.elementFromPoint(t.clientX,t.clientY),this.dragImage.style.display="",(i=a(i,"[data-listo=collection], [data-listo=item]"))!==this.dropTarget)&&(this.dropTarget&&this.dropTarget.classList.remove("lo-droptarget"),i&&this.droppable(this.dragEl,i)&&i.classList.add("lo-droptarget"),this.dropTarget=i)}onTouchEnd(t){clearTimeout(this.holdTimer),this.onDrop(),this.onDragEnd()}onTouchCancel(t){clearTimeout(this.holdTimer)}onItemAdded(){this.init(this.currentCollection)}onItemUpdated(){this.init(this.currentCollection)}onPreferencesUpdated(t){this.manualItemsOrder=!t.items_order,this.init(this.currentCollection)}};function s(t){var e=t.getBoundingClientRect(),i=t.cloneNode(!0);return i.removeAttribute("id"),i.removeAttribute("data-listo"),i.style.position="fixed",i.style.top=e.top+"px",i.style.left=e.left+"px",i.style.width=e.width+"px",i.style.height=e.height+"px",i.style.zIndex=-1,i.classList.add("lo-dragged"),t.parentElement.append(i),i}function a(t,e){for(;t;t=t.parentElement)if(t.matches(e))return t;return null}function d(t,e=0){return e=t.previousElementSibling?d(t.previousElementSibling,e+1):e}}),listo.class("ListoPreferences",function(t,e){const{ajax:i,hooks:o,data:s}=t,a=+s("animation_speed");return class extends t.class("ListoAbstract"){constructor(t){super(t),this.$itemsOrder=this.$container.find("[data-listo=items-order]"),this.$itemsOrderDir=this.$container.find("[data-listo=items-order-dir]"),this.$itemsOrderDirBox=this.$container.find("[data-listo=items-order-dir-box]"),this.$itemsHideDone=this.$container.find("[data-listo=items-hide-done]"),this.$timezone=this.$container.find("[data-listo=timezone]"),this.getPreferences().done(t=>{o.doAction("preferences_init",t)}),o.addAction("preferences_toggle",()=>this.onPreferencesToggle()),o.addAction("toggle_completed",()=>this.onToggleCompleted())}getPreferences(){return i("listowp/v1/preferences").done(t=>{void 0!==t.items_order&&(this.$itemsOrder.val(t.items_order),t.items_order&&void 0!==t.items_order_dir?(this.$itemsOrderDirBox.show(),this.$itemsOrderDir.val(t.items_order_dir)):this.$itemsOrderDirBox.hide()),void 0!==t.items_hide_done&&this.$itemsHideDone.val(t.items_hide_done),void 0!==t.timezone&&this.$timezone.val(t.timezone)})}setPreferences(t,e){return i("listowp/v1/preferences",{id:t,value:e},"PATCH")}onPreferencesToggle(){this.$container.fadeIn(a),e(document).on("keydown.listo-preferences",t=>{"Escape"===t.code&&(e(document).off("keydown.listo-preferences"),this.$container.fadeOut(a))})}onToggleCompleted(){let e=this.$itemsHideDone.get(0);if(!e.disabled){e.selectedIndex=e.selectedIndex?0:1,e.disabled=!0;let t=e.value;this.setPreferences("items_hide_done",t).always(()=>e.disabled=!1).done(()=>o.doAction("preferences_updated",{items_hide_done:t}))}}onPreferencesCloseClick(t){e(document).off("keydown.listo-preferences"),this.$container.fadeOut(a)}onItemsOrderChange(){let t=this.$itemsOrder,e=t.val()||"";e||(this.$itemsOrderDir[0].selectedIndex=0),this.progress(t,"loading"),this.setPreferences("items_order",e).fail(()=>this.progress(t,"fail")).done(()=>{this.progress(t,"done"),e?(this.$itemsOrderDirBox.show(),this.$itemsOrderDir.trigger("change")):(this.$itemsOrderDirBox.hide(),o.doAction("preferences_updated",{items_order:e,items_order_dir:this.$itemsOrderDir.val()}))})}onItemsOrderDirChange(){let t=this.$itemsOrderDir,e=t.val();this.progress(t,"loading"),this.setPreferences("items_order_dir",e).fail(()=>this.progress(t,"fail")).done(()=>{this.progress(t,"done"),o.doAction("preferences_updated",{items_order:this.$itemsOrder.val(),items_order_dir:e})})}onItemsHideDoneChange(){let t=this.$itemsHideDone,e=t.val();this.progress(t,"loading"),this.setPreferences("items_hide_done",e).fail(()=>this.progress(t,"fail")).done(()=>{this.progress(t,"done"),o.doAction("preferences_updated",{items_hide_done:e})})}onTimezoneChange(){let t=this.$timezone,e=t.val();this.progress(t,"loading"),this.setPreferences("timezone",e).fail(()=>this.progress(t,"fail")).done(()=>{this.progress(t,"done"),o.doAction("preferences_updated",{timezone:e})})}onGdprDeleteClick(t){if(t.preventDefault(),t.stopPropagation(),confirm(s("lang.gdpr_delete_confirmation")))return i("listowp/v1/gdpr",{},"DELETE").done(t=>{this.$itemsOrder[0].selectedIndex=0,this.$itemsOrderDir[0].selectedIndex=0,this.$itemsOrderDirBox.hide(),this.$itemsHideDone[0].selectedIndex=0,this.$timezone.val("+00:00"),o.doAction("gdpr_deleted")})}}}),listo.class("ListoCustomIcons",function(t,a){const{ajax:n,hooks:l,template:o}=t;return class{constructor(t,e={}){this.id=e.id,this.smart=!0,this.$container=a(t),this.$toggle=this.$container.find("[data-listo=custom-icon-toggle]"),this.$disabler=this.$container.find("[data-listo=custom-icon-disabler]").hide(),this.$popup=this.$container.find("[data-listo=custom-icon-popup]"),this.$search=this.$popup.find("[type=text]"),this.$list=this.$popup.find("[data-listo=custom-icon-list]"),this.$loading=this.$popup.find("[data-listo=custom-icon-loading]").hide(),this.$clear=this.$popup.find("[data-listo=custom-icon-clear]").hide(),this.$remove=this.$popup.find("[data-listo=custom-icon-remove]").hide(),this.tmplItem=this.$container.find("[data-listo=tmpl-item]").text(),this.$toggle.on("click",t=>this.toggle(t)),this.$popup.on("click",t=>t.stopPropagation()),this.$search.on("input",()=>this.search()),this.$clear.on("click",()=>this.clear()),this.$list.on("click","[data-option]",t=>this.onSelectIcon(t)),this.$remove.on("click",t=>this.onRemoveIcon(t)),a(document).on("click",()=>this.$popup.hide()),l.addAction("set_current_collection",t=>this.update(t)),l.addAction("collection_updated",t=>this.update(t))}update(t){this.smart=+t.smart,this.$toggle.attr("class","lo-list__icon "+(t.icon||"")),this.$toggle.find("[data-field=initials]").html(t.initials||""),this.$popup.hide(),this.$list.empty(),this.$search.val(t.title),t.icon?this.$remove.show():this.$remove.hide()}toggle(t){t.stopPropagation(),this.smart||this.$popup.is(":visible")?(this.$popup.hide(),this.$list.empty()):(this.search(),this.$popup.show(),this.$search.select())}search(){this.$clear.hide(),this.$loading.show(),this.$list.addClass("is-loading"),clearTimeout(this.searchTimer);let i=this.searchTimer=setTimeout(()=>{let e=this.$search.val().trim();return n("listowp/v1/icons",{s:e,limit:105}).done(t=>{i===this.searchTimer&&(this.$loading.hide(),this.$list.removeClass("is-loading"),e?this.$clear.show():this.$clear.hide(),this.render(t.icons))})},1e3)}render(t){let e="";for(const i in t)e+=o(this.tmplItem)({icon:i});this.$list.html(e)}clear(){this.$clear.hide(),this.$search.val(""),this.search()}onSelectIcon(t){t.preventDefault(),t.stopPropagation(),this.$popup.hide(),this.$remove.show(),this.$disabler.show();let e=l.applyFilters("current_collection_id");t=a(t.currentTarget).data("option");let i={id:e,icon:"fa-solid fa-"+t},o=this.$toggle.get(0).classList,s=[...o].filter(t=>t.match(/^fa-/));return o.remove(...s),o.add(...i.icon.split(" ")),n("listowp/v1/collections",i,"PATCH").fail(()=>{this.$disabler.hide(),o.remove(...i.icon.split(" ")),o.add(...s)}).done(()=>{n("listowp/v1/collections",{id:e}).always(()=>this.$disabler.hide()).done(t=>{t instanceof Array&&t[0]&&l.doAction("collection_updated",t[0])})})}onRemoveIcon(t){t.preventDefault(),t.stopPropagation(),this.$popup.hide(),this.$remove.hide(),this.$disabler.show();let e=l.applyFilters("current_collection_id");t={id:e,icon:""};let i=this.$toggle.get(0).classList,o=[...i].filter(t=>t.match(/^fa-/));return i.remove(...o),n("listowp/v1/collections",t,"PATCH").fail(()=>{this.$disabler.hide(),i.add(...o)}).done(()=>{n("listowp/v1/collections",{id:e}).always(()=>this.$disabler.hide()).done(t=>{t instanceof Array&&t[0]&&l.doAction("collection_updated",t[0])})})}}}),function(e,t,i,o={}){function s(){document.querySelectorAll("[data-listo=root]").forEach(t=>{new(e.class("ListoRoot"))(t)})}+t.logged_in&&i(function(){o&&o.domReady?o.domReady(()=>setTimeout(s,0)):s()})}(window.listo,window.listoData,window.jQuery,window.wp);